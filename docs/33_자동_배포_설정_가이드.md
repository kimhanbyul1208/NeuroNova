# GitHub Actions ìë™ ë°°í¬ ì„¤ì • ê°€ì´ë“œ

## ëª©ì°¨
1. [ê°œìš”](#ê°œìš”)
2. [ì‚¬ì „ ì¤€ë¹„](#ì‚¬ì „-ì¤€ë¹„)
3. [GitHub Secrets ì„¤ì •](#github-secrets-ì„¤ì •)
4. [ì„œë²„ ì´ˆê¸° ì„¤ì •](#ì„œë²„-ì´ˆê¸°-ì„¤ì •)
5. [ìë™ ë°°í¬ í…ŒìŠ¤íŠ¸](#ìë™-ë°°í¬-í…ŒìŠ¤íŠ¸)
6. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ê°œìš”

### ìë™ ë°°í¬ í”„ë¡œì„¸ìŠ¤

```
ì½”ë“œ ìˆ˜ì • â†’ git push â†’ GitHub Actions ê°ì§€ â†’ ì„œë²„ SSH ì ‘ì† â†’ ìë™ ë°°í¬ â†’ ì„œë¹„ìŠ¤ ì¬ì‹œì‘
```

**ì†Œìš” ì‹œê°„**: ì•½ 5-10ë¶„ (ìˆ˜ë™ ë°°í¬ 30ë¶„ â†’ ìë™ ë°°í¬ 5ë¶„)

---

## ì‚¬ì „ ì¤€ë¹„

### 1. ì„œë²„ì— í”„ë¡œì íŠ¸ê°€ ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•¨

```bash
# ì„œë²„ ë””ë ‰í† ë¦¬ êµ¬ì¡°
/var/www/neuronova/
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ django_main/
â”‚       â”œâ”€â”€ venv/              # ê°€ìƒí™˜ê²½ (ë¯¸ë¦¬ ìƒì„±ë¨)
â”‚       â”œâ”€â”€ .env               # í™˜ê²½ ë³€ìˆ˜ (ë¯¸ë¦¬ ìƒì„±ë¨)
â”‚       â””â”€â”€ ...
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ react_web/
â”‚       â””â”€â”€ ...
â””â”€â”€ .git/                      # Git ì €ì¥ì†Œ
```

**ì¤‘ìš”**: `.env` íŒŒì¼ì€ ì„œë²„ì— ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘ì–´ì•¼ í•©ë‹ˆë‹¤!

---

## GitHub Secrets ì„¤ì •

### 1. SSH í‚¤ ìƒì„± (ì„œë²„ì—ì„œ)

```bash
# ì„œë²„ì—ì„œ ì‹¤í–‰
ssh-keygen -t rsa -b 4096 -C "github-actions"

# ì €ì¥ ìœ„ì¹˜: /home/ubuntu/.ssh/id_rsa_github
# ë¹„ë°€ë²ˆí˜¸: (ì—”í„° - ë¹„ì›Œë‘ )

# ê³µê°œí‚¤ë¥¼ authorized_keysì— ì¶”ê°€
cat /home/ubuntu/.ssh/id_rsa_github.pub >> /home/ubuntu/.ssh/authorized_keys

# ê°œì¸í‚¤ ë‚´ìš© í™•ì¸ (ë³µì‚¬í•´ë‘ê¸°)
cat /home/ubuntu/.ssh/id_rsa_github
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA...
(ë§¤ìš° ê¸´ ë¬¸ìì—´)
...
-----END RSA PRIVATE KEY-----
```

**ì´ ì „ì²´ ë‚´ìš©ì„ ë³µì‚¬í•˜ì„¸ìš”!** (BEGINë¶€í„° ENDê¹Œì§€ ì „ë¶€)

---

### 2. GitHub Secrets ë“±ë¡

**GitHub ì €ì¥ì†Œ â†’ Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret**

#### ì¶”ê°€í•  Secrets:

| Name | Value | ì„¤ëª… |
|------|-------|------|
| `SERVER_HOST` | `123.456.789.012` | ì„œë²„ IP ì£¼ì†Œ |
| `SERVER_USER` | `ubuntu` | SSH ì‚¬ìš©ì ì´ë¦„ |
| `SSH_PRIVATE_KEY` | ìœ„ì—ì„œ ë³µì‚¬í•œ ê°œì¸í‚¤ ì „ì²´ | SSH ì ‘ì†ìš© ê°œì¸í‚¤ |

**ìŠ¤í¬ë¦°ìƒ· ê°€ì´ë“œ:**

```
1. GitHub ì €ì¥ì†Œ í˜ì´ì§€ ì—´ê¸°
2. Settings í´ë¦­
3. ì™¼ìª½ ë©”ë‰´: Secrets and variables â†’ Actions
4. "New repository secret" ë²„íŠ¼ í´ë¦­
5. Name: SERVER_HOST
   Secret: (ì„œë²„ IP ì…ë ¥)
6. Add secret í´ë¦­
7. ë‚˜ë¨¸ì§€ë„ ë°˜ë³µ
```

---

### 3. Secrets í™•ì¸

ì œëŒ€ë¡œ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸:

```
GitHub ì €ì¥ì†Œ â†’ Settings â†’ Secrets and variables â†’ Actions

í‘œì‹œë˜ì–´ì•¼ í•  Secrets:
âœ… SERVER_HOST
âœ… SERVER_USER
âœ… SSH_PRIVATE_KEY

(ê°’ì€ ë³´ì´ì§€ ì•Šê³  ì´ë¦„ë§Œ í‘œì‹œë¨)
```

---

## ì„œë²„ ì´ˆê¸° ì„¤ì •

### 1. .env íŒŒì¼ ìƒì„± (í•œ ë²ˆë§Œ)

ì„œë²„ì— SSH ì ‘ì† í›„:

```bash
cd /var/www/neuronova/backend/django_main

# .env.example ë³µì‚¬
cp .env.example .env

# ì‹¤ì œ ê°’ìœ¼ë¡œ ìˆ˜ì •
nano .env
```

**í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜:**
```bash
# Django ê¸°ë³¸ ì„¤ì •
DEBUG=False
SECRET_KEY=ì‹¤ì œ-ì‹œí¬ë¦¿-í‚¤-ì—¬ê¸°-ì…ë ¥
ALLOWED_HOSTS=your-domain.com,www.your-domain.com,ì„œë²„IP

# ë°ì´í„°ë² ì´ìŠ¤
DB_NAME=neuronova_db
DB_USER=neuronova_user
DB_PASSWORD=ì‹¤ì œ-DB-ë¹„ë°€ë²ˆí˜¸
DB_HOST=localhost
DB_PORT=3306

# ì™¸ë¶€ API í‚¤
DRUGBANK_API_KEY=ì‹¤ì œ-API-í‚¤
ALPHAFOLD_API_KEY=ì‹¤ì œ-API-í‚¤
PUBCHEM_API_KEY=ì‹¤ì œ-API-í‚¤

# Firebase
FIREBASE_SERVER_KEY=ì‹¤ì œ-ì„œë²„-í‚¤

# ì•”í˜¸í™” í‚¤
ENCRYPTION_KEY=ì‹¤ì œ-ì•”í˜¸í™”-í‚¤

# ML ì„œë¹„ìŠ¤
ML_SERVICE_KEY=ì‹¤ì œ-ì„œë¹„ìŠ¤-í‚¤
ML_API_URL=http://localhost:5001
```

**ì €ì¥**: Ctrl+O â†’ Enter â†’ Ctrl+X

---

### 2. Sudo ê¶Œí•œ ì„¤ì • (ì„œë¹„ìŠ¤ ì¬ì‹œì‘ìš©)

```bash
# sudoers íŒŒì¼ í¸ì§‘
sudo visudo
```

**ë§¨ ì•„ë˜ì— ì¶”ê°€:**
```
# GitHub Actions ìë™ ë°°í¬ë¥¼ ìœ„í•œ ê¶Œí•œ
ubuntu ALL=(ALL) NOPASSWD: /bin/systemctl restart gunicorn_django
ubuntu ALL=(ALL) NOPASSWD: /bin/systemctl reload nginx
ubuntu ALL=(ALL) NOPASSWD: /bin/systemctl is-active gunicorn_django
ubuntu ALL=(ALL) NOPASSWD: /bin/systemctl is-active nginx
```

**ì €ì¥**: Ctrl+O â†’ Enter â†’ Ctrl+X

**í…ŒìŠ¤íŠ¸:**
```bash
# ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ì‹¤í–‰ë˜ì–´ì•¼ í•¨
sudo systemctl is-active gunicorn_django
```

---

### 3. Git ì„¤ì •

```bash
cd /var/www/neuronova

# Git ì‚¬ìš©ì ì„¤ì • (í•œ ë²ˆë§Œ)
git config user.name "Server"
git config user.email "server@neuronova.com"

# ì›ê²© ì €ì¥ì†Œ í™•ì¸
git remote -v

# ì—†ìœ¼ë©´ ì¶”ê°€
git remote add origin https://github.com/your-username/neuronova.git

# í˜„ì¬ ë¸Œëœì¹˜ í™•ì¸
git branch

# main ë¸Œëœì¹˜ë¡œ ë³€ê²½ (í•„ìš” ì‹œ)
git checkout main
```

---

### 4. ë””ë ‰í† ë¦¬ ê¶Œí•œ ì„¤ì •

```bash
# í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ì†Œìœ ì ë³€ê²½
sudo chown -R ubuntu:ubuntu /var/www/neuronova

# ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„± ë° ê¶Œí•œ
sudo mkdir -p /var/log/neuronova
sudo chown -R ubuntu:ubuntu /var/log/neuronova

# Static/Media ë””ë ‰í† ë¦¬ ê¶Œí•œ
sudo chmod -R 755 /var/www/neuronova/backend/django_main/staticfiles
sudo chmod -R 755 /var/www/neuronova/backend/django_main/media
```

---

## ìë™ ë°°í¬ í…ŒìŠ¤íŠ¸

### 1. ì›Œí¬í”Œë¡œìš° íŒŒì¼ í™•ì¸

```bash
# ë¡œì»¬ì—ì„œ í™•ì¸
ls -la .github/workflows/

# ì¶œë ¥:
# deploy.yml (ì´ íŒŒì¼ì´ ìˆì–´ì•¼ í•¨)
```

---

### 2. ì²« ë°°í¬ í…ŒìŠ¤íŠ¸

#### Step 1: ì‘ì€ ë³€ê²½ ë§Œë“¤ê¸°

```bash
# ë¡œì»¬ì—ì„œ
cd ~/NeuroNova

# README ìˆ˜ì • (í…ŒìŠ¤íŠ¸ìš©)
echo "# ìë™ ë°°í¬ í…ŒìŠ¤íŠ¸" >> README.md

git add README.md
git commit -m "test: ìë™ ë°°í¬ í…ŒìŠ¤íŠ¸"
git push origin main
```

#### Step 2: GitHub Actions í™•ì¸

**GitHub ì €ì¥ì†Œ â†’ Actions íƒ­**

```
ì‹¤í–‰ ì¤‘ì¸ ì›Œí¬í”Œë¡œìš° í™•ì¸:
â†’ "í”„ë¡œë•ì…˜ ë°°í¬" (ë…¸ë€ìƒ‰ ì•„ì´ì½˜ - ì‹¤í–‰ ì¤‘)
â†’ í´ë¦­í•˜ì—¬ ë¡œê·¸ í™•ì¸
```

**ë¡œê·¸ ì˜ˆì‹œ:**
```
Run ë°°í¬ ì‹œì‘ ì•Œë¦¼
ğŸš€ NeuroNova ë°°í¬ ì‹œì‘...

Run ì„œë²„ ë°°í¬
===== 1. ì½”ë“œ ì—…ë°ì´íŠ¸ =====
Already up to date.

===== 2. ë°±ì—”ë“œ ì—…ë°ì´íŠ¸ =====
Requirement already satisfied: Django==4.2.0
...

===== 3. í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ =====
npm install
added 1523 packages
npm run build
Creating an optimized production build...
âœ“ Compiled successfully

===== 4. ì„œë¹„ìŠ¤ ì¬ì‹œì‘ =====
âœ… Django ì„œë¹„ìŠ¤ ì •ìƒ ì‹¤í–‰ ì¤‘
âœ… Nginx ì„œë¹„ìŠ¤ ì •ìƒ ì‹¤í–‰ ì¤‘

===== ë°°í¬ ì™„ë£Œ! =====
```

#### Step 3: ë°°í¬ í™•ì¸

```bash
# ì„œë²„ì— ì ‘ì†
ssh ubuntu@your-server-ip

# Git ë¡œê·¸ í™•ì¸
cd /var/www/neuronova
git log -1

# ì¶œë ¥: ë°©ê¸ˆ pushí•œ ì»¤ë°‹ì´ ë³´ì—¬ì•¼ í•¨
# commit abc123...
# Author: Your Name
# Date: ...
# test: ìë™ ë°°í¬ í…ŒìŠ¤íŠ¸

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
sudo systemctl status gunicorn_django
# Active: active (running)

# ì›¹ì‚¬ì´íŠ¸ í™•ì¸
curl http://localhost/
```

---

### 3. ì‹¤ì œ ì½”ë“œ ë³€ê²½ ë°°í¬

```bash
# ë¡œì»¬ì—ì„œ ì½”ë“œ ìˆ˜ì •
cd ~/NeuroNova/backend/django_main/apps/core

# views.py ìˆ˜ì • (ì˜ˆì‹œ)
# ë­”ê°€ ë³€ê²½...

git add .
git commit -m "feat: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€"
git push origin main

# GitHub Actionsê°€ ìë™ìœ¼ë¡œ:
# 1. ì½”ë“œ pull
# 2. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
# 3. ë§ˆì´ê·¸ë ˆì´ì…˜
# 4. Static íŒŒì¼ ìˆ˜ì§‘
# 5. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. SSH ì—°ê²° ì‹¤íŒ¨

**ì—ëŸ¬:**
```
Error: ssh: connect to host XXX.XXX.XXX.XXX port 22: Connection refused
```

**í•´ê²°:**
```bash
# ì„œë²„ì—ì„œ SSH ì„œë¹„ìŠ¤ í™•ì¸
sudo systemctl status ssh

# ë°©í™”ë²½ í™•ì¸
sudo ufw status

# í¬íŠ¸ 22 ì—´ê¸°
sudo ufw allow 22
```

---

### 2. Permission Denied

**ì—ëŸ¬:**
```
Permission denied (publickey)
```

**í•´ê²°:**

1. **SSH í‚¤ í™•ì¸**
```bash
# ì„œë²„ì—ì„œ
cat ~/.ssh/authorized_keys

# GitHubì—ì„œ ë³µì‚¬í•œ ê³µê°œí‚¤ê°€ ìˆëŠ”ì§€ í™•ì¸
```

2. **GitHub Secrets ì¬í™•ì¸**
```
SSH_PRIVATE_KEYì— ê°œì¸í‚¤ ì „ì²´ê°€ ë³µì‚¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
(BEGINë¶€í„° ENDê¹Œì§€ ëª¨ë‘ í¬í•¨)
```

3. **SSH ê¶Œí•œ í™•ì¸**
```bash
# ì„œë²„ì—ì„œ
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

---

### 3. Git Pull ì‹¤íŒ¨

**ì—ëŸ¬:**
```
error: Your local changes to the following files would be overwritten by merge
```

**í•´ê²°:**
```bash
# ì„œë²„ì—ì„œ
cd /var/www/neuronova

# ë¡œì»¬ ë³€ê²½ ì‚¬í•­ í™•ì¸
git status

# ë¡œì»¬ ë³€ê²½ ì‚¬í•­ ì œê±° (ì£¼ì˜!)
git reset --hard origin/main

# ë˜ëŠ” ìŠ¤íƒœì‹œ
git stash
git pull origin main
```

---

### 4. ì„œë¹„ìŠ¤ ì¬ì‹œì‘ ì‹¤íŒ¨

**ì—ëŸ¬:**
```
Failed to restart gunicorn_django.service: Access denied
```

**í•´ê²°:**
```bash
# sudoers ì„¤ì • ì¬í™•ì¸
sudo visudo

# ì•„ë˜ ë‚´ìš©ì´ ìˆëŠ”ì§€ í™•ì¸
ubuntu ALL=(ALL) NOPASSWD: /bin/systemctl restart gunicorn_django
ubuntu ALL=(ALL) NOPASSWD: /bin/systemctl reload nginx

# í…ŒìŠ¤íŠ¸
sudo systemctl restart gunicorn_django
```

---

### 5. npm install ì‹¤íŒ¨

**ì—ëŸ¬:**
```
npm ERR! code EACCES
```

**í•´ê²°:**
```bash
# ì„œë²„ì—ì„œ node_modules ê¶Œí•œ ìˆ˜ì •
cd /var/www/neuronova/frontend/react_web
sudo chown -R ubuntu:ubuntu node_modules
rm -rf node_modules package-lock.json
npm install
```

---

### 6. ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ

**ì—ëŸ¬:**
```
django.db.migrations.exceptions.InconsistentMigrationHistory
```

**í•´ê²°:**
```bash
# ì„œë²„ì—ì„œ
cd /var/www/neuronova/backend/django_main
source venv/bin/activate

# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
python manage.py showmigrations

# ê°€ì§œ ë§ˆì´ê·¸ë ˆì´ì…˜ (ì£¼ì˜!)
python manage.py migrate --fake app_name migration_name

# ë˜ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ ì¬ì„¤ì • (ê°œë°œ í™˜ê²½ì—ì„œë§Œ!)
python manage.py migrate --fake-initial
```

---

## ê³ ê¸‰ ê¸°ëŠ¥

### 1. ë°°í¬ ì „ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```yaml
# .github/workflows/deploy.ymlì— ì¶”ê°€

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run tests
        run: |
          cd backend/django_main
          pip install -r requirements.txt
          python manage.py test

  deploy:
    needs: test  # í…ŒìŠ¤íŠ¸ í†µê³¼ í›„ì—ë§Œ ë°°í¬
    runs-on: ubuntu-latest
    # ...
```

---

### 2. ìŠ¬ë™ ì•Œë¦¼ ì¶”ê°€

```yaml
# ë°°í¬ ì™„ë£Œ í›„ ìŠ¬ë™ ì•Œë¦¼
- name: Slack ì•Œë¦¼
  if: success()
  uses: 8398a7/action-slack@v3
  with:
    status: ${{ job.status }}
    text: 'âœ… NeuroNova ë°°í¬ ì™„ë£Œ!'
    webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
```

---

### 3. ë¡¤ë°± ì›Œí¬í”Œë¡œìš°

```yaml
# .github/workflows/rollback.yml

name: ë¡¤ë°±

on:
  workflow_dispatch:
    inputs:
      commit_hash:
        description: 'ë¡¤ë°±í•  ì»¤ë°‹ í•´ì‹œ'
        required: true

jobs:
  rollback:
    runs-on: ubuntu-latest
    steps:
      - name: ë¡¤ë°± ì‹¤í–‰
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /var/www/neuronova
            git reset --hard ${{ github.event.inputs.commit_hash }}
            # ì„œë¹„ìŠ¤ ì¬ì‹œì‘
            sudo systemctl restart gunicorn_django
```

---

## ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë°°í¬ ì „ í™•ì¸ì‚¬í•­:

### ì„œë²„ ì¤€ë¹„
- [ ] `.env` íŒŒì¼ ìƒì„±ë¨
- [ ] SSH í‚¤ ì„¤ì •ë¨
- [ ] Sudo ê¶Œí•œ ì„¤ì •ë¨
- [ ] Git ì €ì¥ì†Œ ì„¤ì •ë¨
- [ ] ë””ë ‰í† ë¦¬ ê¶Œí•œ ì˜¬ë°”ë¦„

### GitHub ì„¤ì •
- [ ] GitHub Secrets ë“±ë¡ ì™„ë£Œ
- [ ] `.github/workflows/deploy.yml` íŒŒì¼ ì¡´ì¬
- [ ] ì €ì¥ì†Œ ì ‘ê·¼ ê¶Œí•œ í™•ì¸

### í…ŒìŠ¤íŠ¸
- [ ] ìˆ˜ë™ ë°°í¬ë¡œ í•œ ë²ˆ í…ŒìŠ¤íŠ¸
- [ ] ì„œë¹„ìŠ¤ ì¬ì‹œì‘ í…ŒìŠ¤íŠ¸
- [ ] ìë™ ë°°í¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

**ë¬¸ì„œ ë²„ì „**: 1.0
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-12-07
**ì‘ì„±ì**: NeuroNova ê°œë°œíŒ€
