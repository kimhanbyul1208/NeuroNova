# NeuroNova ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

> **ì‘ì„±ì¼**: 2025-12-05
> **ì‘ì„±ì**: NeuroNova Development Team
> **ëª©ì **: ë°°í¬ í™˜ê²½ ì¤€ë¹„ ë° Django ë§ˆì´ê·¸ë ˆì´ì…˜ ì •ë¦¬ ê°€ì´ë“œ

---

## ğŸ“‹ ë°°í¬ ì „ í™˜ê²½ ì •ë¹„

### 1. Python í™˜ê²½ ì •ë¹„

#### 1.1 Python ë²„ì „ í™•ì¸ ë° ì—…ê·¸ë ˆì´ë“œ

```bash
# í˜„ì¬ Python ë²„ì „ í™•ì¸
python3 --version

# Ubuntu/Debianì—ì„œ Python ìµœì‹  ë²„ì „ ì„¤ì¹˜
sudo apt update
sudo apt install python3.11 python3.11-venv python3.11-dev

# ë˜ëŠ” ì†ŒìŠ¤ì—ì„œ ë¹Œë“œ (íŠ¹ì • ë²„ì „ í•„ìš” ì‹œ)
cd /tmp
wget https://www.python.org/ftp/python/3.11.7/Python-3.11.7.tgz
tar -xzf Python-3.11.7.tgz
cd Python-3.11.7
./configure --enable-optimizations
make -j$(nproc)
sudo make altinstall
```

#### 1.2 ê°€ìƒí™˜ê²½ ì¬ìƒì„±

```bash
cd ~/NeuroNova/backend/django_main

# ê¸°ì¡´ ê°€ìƒí™˜ê²½ ì œê±° (ìˆë‹¤ë©´)
rm -rf venv

# ìƒˆ ê°€ìƒí™˜ê²½ ìƒì„±
python3.11 -m venv venv

# ê°€ìƒí™˜ê²½ í™œì„±í™”
source venv/bin/activate

# pip ì—…ê·¸ë ˆì´ë“œ
pip install --upgrade pip setuptools wheel
```

#### 1.3 Requirements ê°±ì‹  (ê°œë°œ í™˜ê²½)

âš ï¸ **ì£¼ì˜**: ì´ ì‘ì—…ì€ ê°œë°œ í™˜ê²½ì—ì„œë§Œ ìˆ˜í–‰í•˜ê³ , ê²°ê³¼ë¥¼ Gitì— ì»¤ë°‹í•©ë‹ˆë‹¤.

```bash
# ê°œë°œ í™˜ê²½ì—ì„œ ì‹¤í–‰ (ë¡œì»¬ PC)
cd backend/django_main
source venv/bin/activate

# í˜„ì¬ ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ ëª©ë¡ ì €ì¥
pip freeze > requirements.txt

# Gitì— ì»¤ë°‹
git add requirements.txt
git commit -m "Update requirements.txt"
git push
```

#### 1.4 íŒ¨í‚¤ì§€ ì¬ì„¤ì¹˜ (ë°°í¬ ì„œë²„)

```bash
# ë°°í¬ ì„œë²„ì—ì„œ ì‹¤í–‰
cd ~/NeuroNova/backend/django_main
source venv/bin/activate

# ìµœì‹  requirementsë¡œ ì¬ì„¤ì¹˜
pip install -r requirements.txt

# ëˆ„ë½ëœ ë°°í¬ ì „ìš© íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install gunicorn mysqlclient python-dotenv
```

---

### 2. Node.js í™˜ê²½ ì •ë¹„

#### 2.1 Node.js ë²„ì „ í™•ì¸

```bash
# Node.js ë²„ì „ í™•ì¸
node --version
npm --version

# 18.x ì´ìƒ ê¶Œì¥
```

#### 2.2 Node.js ì—…ê·¸ë ˆì´ë“œ (í•„ìš” ì‹œ)

```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install nodejs -y

# ë˜ëŠ” nvm ì‚¬ìš©
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 20
nvm use 20
```

#### 2.3 React ë¹Œë“œ

```bash
cd ~/NeuroNova/frontend/react_web

# node_modules ì‚­ì œ ë° ì¬ì„¤ì¹˜ (ì„ íƒ ì‚¬í•­)
rm -rf node_modules package-lock.json
npm install

# í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run build

# dist í´ë” í™•ì¸
ls -la dist/
```

---

### 3. Nginx ì„¤ì •

#### 3.1 Nginx ì„¤ì¹˜ ë° í™•ì¸

```bash
# Nginx ì„¤ì¹˜ (ì•„ì§ ì„¤ì¹˜ ì•ˆ ëœ ê²½ìš°)
sudo apt install nginx -y

# Nginx ë²„ì „ í™•ì¸
nginx -v

# Nginx ìƒíƒœ í™•ì¸
sudo systemctl status nginx
```

#### 3.2 ì„¤ì • íŒŒì¼ ìˆ˜ì •

```bash
# ì„¤ì • íŒŒì¼ ë°±ì—…
sudo cp /etc/nginx/sites-available/neuronova /etc/nginx/sites-available/neuronova.bak

# ì„¤ì • íŒŒì¼ ìˆ˜ì •
sudo nano /etc/nginx/sites-available/neuronova
```

**ì£¼ìš” ìˆ˜ì • ì‚¬í•­:**
- `server_name`: ì‹¤ì œ ë„ë©”ì¸ ë˜ëŠ” IPë¡œ ë³€ê²½
- `root`: React ë¹Œë“œ ê²°ê³¼ë¬¼ ê²½ë¡œ í™•ì¸ (`/home/ubuntu/NeuroNova/frontend/react_web/dist`)
- `alias`: Django staticfiles, media ê²½ë¡œ í™•ì¸

#### 3.3 ê¸°ì¡´ ì„¤ì • ì œê±°

```bash
# ê¸°ë³¸ ì‚¬ì´íŠ¸ ì„¤ì • ë¹„í™œì„±í™”
sudo rm /etc/nginx/sites-enabled/default

# ìš°ë¦¬ ì„¤ì • í™œì„±í™”
sudo ln -sf /etc/nginx/sites-available/neuronova /etc/nginx/sites-enabled/
```

#### 3.4 ì„¤ì • ì ìš©

```bash
# ì„¤ì • íŒŒì¼ ë¬¸ë²• ê²€ì‚¬
sudo nginx -t

# Nginx ì¬ì‹œì‘
sudo systemctl reload nginx

# ë˜ëŠ”
sudo systemctl restart nginx
```

---

### 4. Python ë²„ì „ ì¶©ëŒ ë°©ì§€

#### 4.1 ì‹œìŠ¤í…œ Pythonê³¼ ë¶„ë¦¬

âš ï¸ **ì¤‘ìš”**: ì‹œìŠ¤í…œ Pythonì„ ì§ì ‘ ì—…ê·¸ë ˆì´ë“œí•˜ì§€ ë§ˆì„¸ìš”. ë³„ë„ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
# ì‹œìŠ¤í…œ Python í™•ì¸
which python3
python3 --version

# ìƒˆ Python ë²„ì „ì„ ë³„ë„ ê²½ë¡œì— ì„¤ì¹˜
# /usr/local/bin/python3.11 í˜•íƒœë¡œ ì„¤ì¹˜ë¨
```

#### 4.2 Python ì†ŒìŠ¤ ë¹Œë“œ (íŠ¹ì • ë²„ì „ í•„ìš” ì‹œ)

```bash
cd /tmp

# ì›í•˜ëŠ” Python ë²„ì „ ë‹¤ìš´ë¡œë“œ
wget https://www.python.org/ftp/python/3.11.7/Python-3.11.7.tgz
tar -xzf Python-3.11.7.tgz
cd Python-3.11.7

# ë¹Œë“œ ì„¤ì •
./configure --enable-optimizations --prefix=/opt/python3.11

# ì»´íŒŒì¼ (ì‹œê°„ ì†Œìš”)
make -j$(nproc)

# ì„¤ì¹˜
sudo make install

# ì‹¬ë³¼ë¦­ ë§í¬ ìƒì„± (ì„ íƒ ì‚¬í•­)
sudo ln -s /opt/python3.11/bin/python3.11 /usr/local/bin/python3.11
```

#### 4.3 ê°€ìƒí™˜ê²½ì—ì„œ íŠ¹ì • Python ë²„ì „ ì‚¬ìš©

```bash
# íŠ¹ì • Python ë²„ì „ìœ¼ë¡œ ê°€ìƒí™˜ê²½ ìƒì„±
/opt/python3.11/bin/python3.11 -m venv ~/NeuroNova/backend/django_main/venv

# ë˜ëŠ”
python3.11 -m venv ~/NeuroNova/backend/django_main/venv
```

---

### 5. Nginx + Gunicorn êµ¬ì„± í™•ì¸

#### 5.1 Gunicorn ì„¤ì¹˜ í™•ì¸

```bash
# Django ê°€ìƒí™˜ê²½
cd ~/NeuroNova/backend/django_main
source venv/bin/activate
which gunicorn
gunicorn --version

# Flask ê°€ìƒí™˜ê²½
cd ~/NeuroNova/backend/flask_inference
source venv/bin/activate
which gunicorn
gunicorn --version
```

#### 5.2 Systemd ì„œë¹„ìŠ¤ íŒŒì¼ í™•ì¸

```bash
# Django ì„œë¹„ìŠ¤ íŒŒì¼
sudo cat /etc/systemd/system/gunicorn_django.service

# Flask ì„œë¹„ìŠ¤ íŒŒì¼
sudo cat /etc/systemd/system/gunicorn_flask.service
```

**í™•ì¸ ì‚¬í•­:**
- `WorkingDirectory`: í”„ë¡œì íŠ¸ ê²½ë¡œê°€ ì •í™•í•œì§€ í™•ì¸
- `Environment="PATH=..."`: ê°€ìƒí™˜ê²½ ê²½ë¡œê°€ ì •í™•í•œì§€ í™•ì¸
- `ExecStart`: gunicorn ì‹¤í–‰ ê²½ë¡œê°€ ì •í™•í•œì§€ í™•ì¸
- `User`: ì„œë²„ ì‚¬ìš©ì ì´ë¦„ì´ ì •í™•í•œì§€ í™•ì¸ (ubuntu, acorn ë“±)

#### 5.3 ì„œë¹„ìŠ¤ í™œì„±í™” ë° ì‹œì‘

```bash
# ë°ëª¬ ë¦¬ë¡œë“œ
sudo systemctl daemon-reload

# ì„œë¹„ìŠ¤ í™œì„±í™” (ë¶€íŒ… ì‹œ ìë™ ì‹œì‘)
sudo systemctl enable gunicorn_django
sudo systemctl enable gunicorn_flask

# ì„œë¹„ìŠ¤ ì‹œì‘
sudo systemctl start gunicorn_django
sudo systemctl start gunicorn_flask

# ìƒíƒœ í™•ì¸
sudo systemctl status gunicorn_django
sudo systemctl status gunicorn_flask
```

---

## ğŸ—„ï¸ Django ë§ˆì´ê·¸ë ˆì´ì…˜ ì •ë¦¬

### ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì´ ë§ì•„ì§€ëŠ” ë¬¸ì œ

ê°œë°œ ê³¼ì •ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì´ ëˆ„ì ë˜ë©´:
- ë°°í¬ ì†ë„ ì €í•˜
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ ë°œìƒ ê°€ëŠ¥
- Git íˆìŠ¤í† ë¦¬ ë³µì¡í™”

### Squash Migration (ë§ˆì´ê·¸ë ˆì´ì…˜ í†µí•©)

#### 1. ë°±ì—… ìƒì„±

```bash
# ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
mysqldump -u username -p database_name > backup_$(date +%Y%m%d).sql

# ë§ˆì´ê·¸ë ˆì´ì…˜ í´ë” ë°±ì—…
cp -r apps/emr/migrations apps/emr/migrations.bak
```

#### 2. Squash ì‹¤í–‰

```bash
cd ~/NeuroNova/backend/django_main
source venv/bin/activate

# emr ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ í†µí•© (0001ë¶€í„° 0005ê¹Œì§€)
python manage.py squashmigrations emr 0001 0005

# ì¶œë ¥ ì˜ˆì‹œ:
# Will squash the following migrations:
#  - 0001_initial
#  - 0002_alter_patient_user
#  - 0003_patient_doctor
#  - 0004_alter_patient_email
#  - 0005_alter_encounter_created_at_...
# Do you wish to proceed? [yN] y
```

#### 3. Squashed íŒŒì¼ ì •ë¦¬

```bash
# ìƒì„±ëœ squashed íŒŒì¼ í™•ì¸
ls -la apps/emr/migrations/

# ê¸°ì¡´ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì‚­ì œ
cd apps/emr/migrations
rm 0001_initial.py 0002_*.py 0003_*.py 0004_*.py 0005_*.py

# Squashed íŒŒì¼ì„ 0001_initial.pyë¡œ ì´ë¦„ ë³€ê²½
mv 0001_initial_squashed_0005_*.py 0001_initial.py

# 0001_initial.py íŒŒì¼ ìˆ˜ì •
nano 0001_initial.py
```

#### 4. 0001_initial.py ìˆ˜ì •

íŒŒì¼ì„ ì—´ì–´ì„œ ë‹¤ìŒ ë¶€ë¶„ì„ ìˆ˜ì •:

```python
class Migration(migrations.Migration):
    # replaces ì†ì„± ì‚­ì œ (ìˆë‹¤ë©´)
    # replaces = [
    #     ("emr", "0001_initial"),
    #     ...
    # ]

    initial = True  # ì´ ì¤„ ì¶”ê°€

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]
```

#### 5. ì˜ì¡´ì„± íŒŒì¼ ìˆ˜ì •

ë‹¤ë¥¸ ì•±ì´ emrì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì°¸ì¡°í•˜ëŠ” ê²½ìš° ìˆ˜ì •:

```bash
# custom ì•±ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸
grep -r "emr.*0002" apps/custom/migrations/

# ë°œê²¬ëœ íŒŒì¼ ìˆ˜ì •
nano apps/custom/migrations/0002_*.py
```

```python
# ë³€ê²½ ì „
dependencies = [
    ("custom", "0001_initial"),
    ("emr", "0002_alter_patient_user"),  # âŒ
]

# ë³€ê²½ í›„
dependencies = [
    ("custom", "0001_initial"),
    ("emr", "0001_initial"),  # âœ…
]
```

#### 6. ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸

```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
python manage.py showmigrations

# ë¬¸ë²• ì˜¤ë¥˜ í™•ì¸
python manage.py makemigrations --check --dry-run

# ì¶œë ¥:
# No changes detected
```

#### 7. Git ì»¤ë°‹

```bash
git add apps/emr/migrations/
git add apps/custom/migrations/
git commit -m "Squash EMR migrations into single 0001_initial"
git push
```

---

## âœ… ìµœì¢… ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### í™˜ê²½ ì„¤ì •
- [ ] Python ê°€ìƒí™˜ê²½ ì¬ìƒì„± ì™„ë£Œ
- [ ] requirements.txt ìµœì‹  ë²„ì „ìœ¼ë¡œ ê°±ì‹ 
- [ ] Node.js ë° npm ìµœì‹  ë²„ì „ ì„¤ì¹˜
- [ ] React í”„ë¡œë•ì…˜ ë¹Œë“œ ì™„ë£Œ (dist í´ë” ìƒì„±)

### ì„œë²„ ì„¤ì •
- [ ] Nginx ì„¤ì • íŒŒì¼ ìˆ˜ì • ì™„ë£Œ
- [ ] Nginx ë¬¸ë²• ê²€ì‚¬ í†µê³¼ (`nginx -t`)
- [ ] ê¸°ì¡´ default ì‚¬ì´íŠ¸ ë¹„í™œì„±í™”
- [ ] Gunicorn systemd ì„œë¹„ìŠ¤ íŒŒì¼ í™•ì¸

### Django ì„¤ì •
- [ ] `.env` íŒŒì¼ ì‹¤ì œ ìš´ì˜ ê°’ìœ¼ë¡œ ìˆ˜ì •
- [ ] `DEBUG = False` ì„¤ì •
- [ ] `ALLOWED_HOSTS` ì‹¤ì œ ë„ë©”ì¸/IP ì„¤ì •
- [ ] `SECRET_KEY` ê°•ë ¥í•œ ëœë¤ ê°’ìœ¼ë¡œ ë³€ê²½
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ í™•ì¸
- [ ] `collectstatic` ì‹¤í–‰ ì™„ë£Œ
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ í†µí•© (squash) ì™„ë£Œ

### Flask ì„¤ì •
- [ ] `.env` íŒŒì¼ì˜ API_KEYê°€ Djangoì™€ ì¼ì¹˜
- [ ] `final_model` ë””ë ‰í† ë¦¬ ì—…ë¡œë“œ ì™„ë£Œ
- [ ] Flaskê°€ 127.0.0.1:9000ì—ì„œ ë™ì‘ í™•ì¸

### ë³´ì•ˆ
- [ ] ë°©í™”ë²½(UFW) ì„¤ì • ì™„ë£Œ
- [ ] HTTPS ì¸ì¦ì„œ ì„¤ì¹˜ (Let's Encrypt)
- [ ] Flask í¬íŠ¸(9000)ê°€ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ë¶ˆê°€ëŠ¥í•œì§€ í™•ì¸
- [ ] API í‚¤ê°€ Gitì— í¬í•¨ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸

### ì„œë¹„ìŠ¤ ë™ì‘ í™•ì¸
- [ ] `sudo systemctl status gunicorn_django` - ì •ìƒ ë™ì‘
- [ ] `sudo systemctl status gunicorn_flask` - ì •ìƒ ë™ì‘
- [ ] `sudo systemctl status nginx` - ì •ìƒ ë™ì‘
- [ ] ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì‚¬ì´íŠ¸ ì ‘ì† í™•ì¸
- [ ] Django Admin ì ‘ì† í™•ì¸
- [ ] ML API í…ŒìŠ¤íŠ¸ (`/ml/v1/predict/`)

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Python ë²„ì „ ì¶©ëŒ

**ë¬¸ì œ**: `networkx==3.6` ì„¤ì¹˜ ì‹¤íŒ¨
```
ERROR: Could not find a version that satisfies the requirement networkx==3.6
```

**ì›ì¸**: networkx 3.6ì€ Python 3.13+ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥

**í•´ê²°**:
```bash
# requirements.txt ìˆ˜ì •
networkx==3.4.2  # Python 3.10-3.12 í˜¸í™˜

# ë˜ëŠ” Python 3.13 ì„¤ì¹˜ (ìœ„ì˜ "4.2 Python ì†ŒìŠ¤ ë¹Œë“œ" ì°¸ì¡°)
```

### Gunicorn Worker Timeout

**ë¬¸ì œ**: Gunicorn worker timeout ì˜¤ë¥˜

**í•´ê²°**:
```bash
# systemd ì„œë¹„ìŠ¤ íŒŒì¼ ìˆ˜ì •
sudo nano /etc/systemd/system/gunicorn_django.service

# --timeout ê°’ ì¦ê°€
ExecStart=.../gunicorn --timeout 300 ...

# ì¬ì‹œì‘
sudo systemctl daemon-reload
sudo systemctl restart gunicorn_django
```

### Nginx 502 Bad Gateway

**ì›ì¸**: Gunicornì´ ì‹¤í–‰ ì¤‘ì´ì§€ ì•Šê±°ë‚˜ í¬íŠ¸ê°€ ë‹¤ë¦„

**í™•ì¸**:
```bash
# Gunicorn ìƒíƒœ í™•ì¸
sudo systemctl status gunicorn_django

# í¬íŠ¸ ë¦¬ìŠ¤ë‹ í™•ì¸
sudo netstat -tulpn | grep 8000

# ë¡œê·¸ í™•ì¸
sudo journalctl -u gunicorn_django -n 50
```

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- [Django ë°°í¬ ê°€ì´ë“œ](./09_ë°°í¬ê°€ì´ë“œ.md)
- [ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬](https://docs.djangoproject.com/en/5.0/topics/migrations/)
- [Nginx ì„¤ì •](https://nginx.org/en/docs/)
- [Gunicorn ì„¤ì •](https://docs.gunicorn.org/en/stable/settings.html)

---

**ë¬¸ì„œ ë²„ì „**: 1.0.0
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-12-05
