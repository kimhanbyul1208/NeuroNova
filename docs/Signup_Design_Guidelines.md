# 회원가입 로직 설계시 유의사항

## 1. 기본 설계 원칙
- **보안 우선**: 비밀번호는 절대 평문으로 저장하지 않으며, 백엔드에서 `bcrypt` 혹은 `argon2` 로 해시 처리합니다.
- **클라이언트‑사이드 검증**과 **서버‑사이드 검증**을 모두 수행합니다. 클라이언트 검증은 UX 향상을 위해, 서버 검증은 실제 보안을 담당합니다.
- **RESTful API 계약**을 명확히 정의하고, 프론트엔드와 백엔드가 동일한 필드 명과 형식을 사용하도록 합니다.
- **에러 메시지는 사용자 친화적**이어야 하며, 내부 스택 트레이스는 절대 노출하지 않습니다.

## 2. 입력 검증
| 필드 | 검증 내용 | 권고 구현 방식 |
|------|----------|----------------|
| `username` | 최소 4자, 알파벳·숫자·`_` 허용 | 정규식 `/^[a-zA-Z0-9_]{4,}$/` |
| `email` | RFC 5322 준수 이메일 형식 | HTML5 `type="email"` + 정규식 검증 |
| `password` | 최소 8자, 대문자·소문자·숫자·특수문자 중 3가지 이상 | 정규식 `/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/` |
| `password_confirm` | `password`와 동일 여부 확인 | 클라이언트에서 `===` 비교 |
| `phone_number` | `010-1234-5678` 형태, 하이픈 포함 | 정규식 `/^[0-9]{2,3}-[0-9]{3,4}-[0-9]{4}$/` |
| `role` | 허용된 enum 값(`PATIENT`, `DOCTOR`, `NURSE`, `ADMIN`) | 프론트엔드 `select` 로 제한, 서버에서도 enum 검증 |
| `department`, `license_number` | `role`이 `DOCTOR`/`NURSE` 일 때 필수 | 조건부 검증 로직 구현 |

## 3. API 설계
- **엔드포인트**: `POST /api/auth/register/`
- **요청 Body** (JSON):
  ```json
  {
    "username": "string",
    "email": "string",
    "password": "string",
    "password_confirm": "string",
    "first_name": "string",
    "last_name": "string",
    "role": "PATIENT|DOCTOR|NURSE|ADMIN",
    "phone_number": "string",
    "department": "string (optional)",
    "license_number": "string (optional)"
  }
  ```
- **응답**:
  - `201 Created` → 회원가입 성공
  - `400 Bad Request` → 필드별 오류 객체 반환 (예: `{"username": ["이미 사용 중인 사용자명입니다."]}`)
  - `409 Conflict` → 중복 사용자명/이메일
- **에러 포맷**: `field: [messages]` 형태와 `non_field_errors` 배열을 포함하도록 설계

## 4. 보안 고려사항
1. **HTTPS**: 모든 통신은 TLS(HTTPS)로 암호화합니다.
2. **CSRF 방어**: `SameSite=Lax` 쿠키와 CSRF 토큰을 사용합니다.
3. **Rate Limiting**: 동일 IP에서 5분당 최대 10회 시도 제한 (Django‑Ratelimit 등).
4. **비밀번호 정책**: 최소 8자, 복잡도 요구, 비밀번호 재사용 방지.
5. **이메일 인증**(선택): 회원가입 후 이메일 인증 토큰 발송 → 인증 완료 전 로그인 제한.
6. **로그 기록**: 실패한 로그인·회원가입 시 IP와 시각을 로깅.

## 5. 사용자 경험(UX) 개선
- **실시간 검증**: 입력 중 즉시 오류 표시 (MUI `error` prop 사용).
- **로딩 스피너**: API 호출 시 `CircularProgress` 로 버튼 교체.
- **성공 피드백**: `Alert` 로 성공 메시지 표시 후 자동 로그인 혹은 페이지 이동.
- **폼 초기화**: 성공 후 `formData` 를 초기값으로 리셋.
- **접근성**: `label` 과 `aria‑label` 을 정확히 지정하고, 키보드 네비게이션 지원.

## 6. 환자·사용자 연동 (특수 케이스)
- **OneToOne 관계**: `Patient` 모델이 `User` 와 1:1 매핑될 경우, 회원가입 시 `User` 를 먼저 생성하고 `Patient` 를 연관시킵니다.
- **PID 자동 생성**: 백엔드에서 고유 PID 를 생성하도록 설계하고, 프론트엔드에서는 빈 값일 경우 자동 생성 로직을 제공(중복 방지를 위해 재시도 로직 포함).
- **에러 처리**: PID 중복 시 `400` 응답에 `pid` 필드 오류를 포함하고, 프론트엔드에서 재시도 로직을 트리거합니다.

## 7. 테스트 전략
- **단위 테스트**: `handleSubmit` 로직, 검증 함수, API 호출 모킹.
- **통합 테스트**: 실제 백엔드와 연동하여 성공·실패 시나리오 검증.
- **E2E 테스트**(Cypress): 전체 회원가입 흐름, 오류 메시지, 리다이렉션 확인.
- **보안 테스트**: CSRF, Rate Limiting, 입력값 인젝션 테스트.

---
> 이 문서는 **NeuroNova** 프로젝트의 회원가입 로직을 설계·구현할 때 반드시 검토해야 할 체크리스트와 권고사항을 정리한 가이드입니다. 프로젝트에 맞게 필요에 따라 추가·수정하시기 바랍니다.
