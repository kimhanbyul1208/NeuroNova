Django ML Inference Proxy & Logging App 구현 요청서

1. 프로젝트 목표

Flask 기반의 ML 추론 서버(Port 9000)와 통신하는 Django 프록시 앱(ml_proxy)을 구축합니다. 단순 프록시 역할을 넘어, 추론 결과를 Django DB(SQLite/PostgreSQL 등)에 저장하고, 저장된 이력을 의사/환자 조건에 따라 조회할 수 있는 API를 제공해야 합니다.

2. 환경 설정 정보

구분

설정 값 / 설명

비고

Flask ML 서버 주소

http://127.0.0.1:9000

포트 9000번 사용 (Localhost)

Flask API 원형

/api/v1/predict, /api/v1/status 등

Flask 라우터에 정의됨

Django 앱 이름

ml_proxy

신규 생성

데이터베이스

Django 기본 DB 사용

추론 이력 저장용

3. 상세 요구 사항

A. 데이터베이스 모델 설계 (models.py)

추론 결과를 저장하기 위한 InferenceLog 모델을 생성합니다.

모델명: InferenceLog

필드 구성:

doctor_name (CharField): 담당 의사 이름 (조회 조건용)

patient_name (CharField): 환자 이름 (조회 조건용)

input_data (JSONField 또는 TextField): 추론 요청 데이터 (전체 Payload)

output_data (JSONField 또는 TextField): Flask에서 받은 추론 결과

created_at (DateTimeField): 생성 일시 (auto_now_add=True)

B. 프록시 로직 및 데이터 저장 (views.py)

Django 뷰에서 requests 라이브러리를 사용하여 Flask로 요청을 전달합니다.

일반 프록시: /status, /model-info, /retrain 등은 요청/응답을 단순 전달(Pass-through)합니다.

저장 기능이 포함된 프록시 (/predict):

React에서 오는 요청 Body에는 doctor_name, patient_name, 그리고 추론 데이터가 포함되어 있다고 가정합니다.

Django는 이 요청을 Flask(http://127.0.0.1:9000/api/v1/predict)로 보냅니다.

Flask로부터 응답(성공)을 받으면, 요청 정보(의사, 환자, 입력값)와 결과값(Flask 응답)을 InferenceLog 모델에 **저장(Save)**해야 합니다.

저장 후, Flask의 응답을 그대로 React로 반환합니다.

C. 이력 조회 API 구현 (views.py)

저장된 추론 데이터를 조회하는 단일 API 엔드포인트를 구현합니다.

URL: /ml/v1/history/ (GET)

쿼리 파라미터: doctor, patient

분기 로직 (Filtering): 하나의 View 함수 내에서 처리합니다.

의사 & 환자 모두 존재: doctor_name과 patient_name이 모두 일치하는 데이터 조회.

의사만 존재: 해당 doctor_name의 모든 기록 조회.

환자만 존재: 해당 patient_name의 모든 기록 조회.

(옵션) 파라미터 없음: 전체 조회 혹은 빈 리스트 반환 (AI가 적절히 판단).

응답 형식: 조회된 InferenceLog 리스트를 JSON 형태로 반환.

D. URL 매핑 구조

Django URL

Flask Target / 역할

Method

비고

/ml/v1/predict/

...:9000/api/v1/predict

POST

DB 저장 로직 포함

/ml/v1/status/

...:9000/api/v1/status

GET

단순 프록시

/ml/v1/model-info/

...:9000/api/v1/model-info

GET

단순 프록시

/ml/v1/retrain/

...:9000/api/v1/retrain

POST

단순 프록시

/ml/v1/history/

(Django DB 조회)

GET

신규 조회 API

4. 생성 및 수정 요청 파일 목록

AI는 다음 파일들을 생성/수정하여 기능을 완성해야 합니다.

ml_proxy/models.py: InferenceLog 모델 정의.

ml_proxy/views.py:

Flask 프록시 뷰 (DB 저장 로직 포함).

이력 조회(History) 뷰 (조건 분기 포함).

ml_proxy/urls.py: 위 5개 URL에 대한 라우팅.

ml_proxy/admin.py: 관리자 페이지에서 데이터를 볼 수 있도록 모델 등록.

backend/settings.py: 앱 등록 및 설정 확인.